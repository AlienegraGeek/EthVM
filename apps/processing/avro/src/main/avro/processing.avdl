@namespace("io.enkrypt.avro.processing")
protocol Processing {

  import idl "common.avdl";
  import idl "capture.avdl";

  record TransactionKeyRecord {
    string hash;
  }

  record TransactionReceiptKeyRecord {
    string transactionHash;
  }

  record TraceKeyRecord {
    string blockHash;
    union { null, string } transactionHash = null;
    array<int> traceAddress;
  }

  record FungibleBalanceKeyRecord {
    string address;
    union { null, string } contract = null;
  }

  enum FungibleTokenType {
    ETHER, ERC20
  }

  enum FungibleBalanceDeltaType {
    PREMINE_BALANCE,
    HARD_FORK,
    BLOCK_REWARD,
    UNCLE_REWARD,
    MINER_FEE,
    TX_FEE,
    TX,
    CONTRACT_DESTRUCTION,
    TOKEN_TRANSFER
  }

  record FungibleBalanceDeltaRecord {

    FungibleTokenType tokenType;
    FungibleBalanceDeltaType deltaType;
    io.enkrypt.avro.common.TraceLocationRecord traceLocation;
    decimal(40,0) amount;

    union { null, string } address = null;
    union { null, string } contractAddress = null;
  }

  record FungibleBalanceRecord {
    decimal(40,0) amount;
  }

  record FungibleBalanceDeltaListRecord {
    boolean apply = true;
    array<FungibleBalanceDeltaRecord> deltas = [];
    array<FungibleBalanceDeltaRecord> reversals = [];
    union { null, string } blockHash = null;
  }

//

  record NonFungibleBalanceKeyRecord {
    string contract;
    decimal(40,0) tokenId;
  }

  enum NonFungibleTokenType {
    ERC721
  }

  record NonFungibleBalanceDeltaRecord {

    NonFungibleTokenType tokenType = null;
    io.enkrypt.avro.common.TraceLocationRecord traceLocation;

    string from;
    string to;

    union { null, string } contract = null;
    union { null, decimal(40,0) } tokenId;

  }

  record NonFungibleBalanceRecord {
    io.enkrypt.avro.common.TraceLocationRecord traceLocation;
    string address;
  }

  record NonFungibleBalanceDeltaListRecord {
    boolean apply = true;
    array<NonFungibleBalanceDeltaRecord> deltas = [];
    array<NonFungibleBalanceDeltaRecord> reversals = [];
    union { null, string } blockHash = null;
  }

//

  record BlockAuthorRecord {
    string author;
    decimal(40,0) blockNumber;
    string blockHash;
  }

  record TransactionGasPriceRecord {
    decimal(40,0) blockNumber;
    string blockHash;
    string transactionHash;
    int transactionPosition;
    string address;
    decimal(40,0) gasPrice;
  }

  record TransactionGasPriceListRecord {
    array<TransactionGasPriceRecord> gasPrices;
    union { null, string } blockHash = null;
  }

  record TransactionGasUsedRecord {
    decimal(40,0) gasUsed;
  }

  record TransactionGasUsedListRecord {
    array<TransactionGasUsedRecord> gasUsed;
    union { null, string } blockHash = null;
  }

  record TransactionFeeRecord {
    decimal(40,0) blockNumber;
    string blockHash;
    string transactionHash;
    int transactionPosition;
    string address;
    decimal(40,0) transactionFee;
  }

  record TransactionFeeListRecord {
    array<TransactionFeeRecord> transactionFees;
    union { null, string } blockHash = null;
  }

// metrics

  record BlockTimestampRecord {
    long timestamp;
  }

  record BlockHeaderMetricsRecord {
    union { null, long } blockTime = null;
    long timestamp;
    int numUncles;
    decimal(40,0) difficulty;
    decimal(40,0) totalDifficulty;
  }

  record BlockTransactionTraceMetricsRecord {
    int totalTxs;
    int numSuccessfulTxs;
    int numFailedTxs;
    int numInternalTxs;
    union { null, long } timestamp = null;
  }

  record BlockTransactionMetricsRecord {
    decimal(40,0) totalGasPrice;
    decimal(40,0) avgGasLimit;
    decimal(40,0) avgGasPrice;
    union { null, long } timestamp = null;
  }

  record BlockTransactionFeeMetricsRecord {
    decimal(40,0) totalTxFees;
    decimal(40,0) avgTxFees;
    union { null, long } timestamp = null;
  }

  record MetricKeyRecord {
    long `date`;
    string name;
  }

  record MetricRecord {

    union { null, int } `int` = null;
    union { null, long } `long` = null;
    union { null, float } `float` = null;
    union { null, double } `double` = null;
    union { null, bytes } `bigInteger` = null;

  }

// Processing Metadata

  record ProcessingMetadataKeyRecord {
    string name;
  }

  record ProcessingMetadataRecord {
    union { null, string } `string` = null;
    union { null, boolean } `boolean` = null;
    union { null, int } `int` = null;
    union { null, long } `long` = null;
    union { null, float } `float` = null;
    union { null, double } `double` = null;
    union { null, bytes } `bigInteger` = null;
  }

// address metadata

  enum AddressMetadataType {
    OUT_TX_COUNT, IN_TX_COUNT, TOTAL_TX_COUNT, MINER, CONTRACT_CREATOR
  }

  record AddressMetadataKeyRecord {
    bytes address;
    AddressMetadataType type;
  }

  record AddressMetadataRecord {
    union { null, long } count = null;
    union { null, boolean } flag = null;
  }

}

